{"version":3,"file":"window-view.service.js","sourceRoot":"","sources":["file:///D:/projects/ng2-window-view/src/lib/window-view.service.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAE2C,eAAe,CAAC,CAAA;AAC3D,wBAAwB,cAAc,CAAC,CAAA;AAKvC;IAkBE,2BAAoB,GAA2B;QAA3B,QAAG,GAAH,GAAG,CAAwB;QAhBvC,UAAK,GAAwB,EAAE,CAAC;QAIhC,aAAQ,GAAoB,IAAI,iBAAO,EAAU,CAAC;QAElD,aAAQ,GAA+B,IAAI,iBAAO,EAAqB,CAAC;QAExE,cAAS,GAA+B,IAAI,iBAAO,EAAqB,CAAC;IAQ/B,CAAC;IANnD,sBAAI,sCAAO;aAAX,cAAoC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAE1E,sBAAI,sCAAO;aAAX,cAA+C,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAErF,sBAAI,uCAAQ;aAAZ,cAAgD,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAIvF,qCAAS,GAAT,UAAU,MAAwB;QAChC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAED,sCAAU,GAAV,UAAW,SAAe,EAAE,SAA4C;QAAxE,iBAQC;QAR2B,yBAA4C,GAA5C,cAA4C;QACtE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,kBAAkB,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC;aAClE,IAAI,CAAC,UAAC,YAA+B;YACpC,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC9B,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACjC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YACtC,MAAM,CAAC,YAAY,CAAC;QACtB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,qCAAS,GAAT;QACE,IAAI,YAAY,GAAsB,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QACvD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC9B,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAClC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACtC,YAAY,CAAC,OAAO,EAAE,CAAC;QACvB,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;IAED,8CAAkB,GAAlB,UAAmB,YAA8C;QAC/D,EAAE,CAAC,CAAC,CAAC,YAAY,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC,CAAC;YAC9C,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QACD,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;IACpD,CAAC;IApDH;QAAC,iBAAU,EAAE;;yBAAA;IAsDb,wBAAC;AAAD,CAAC,AArDD,IAqDC;AArDY,yBAAiB,oBAqD7B,CAAA","sourcesContent":["import { Injectable, Type, Injector,\r\n         DynamicComponentLoader, ViewContainerRef, ComponentRef,\r\n         ResolvedReflectiveProvider } from '@angular/core';\r\nimport { Subject } from 'rxjs/Subject';\r\nimport { Observable } from 'rxjs/Observable';\r\nimport { WindowViewCanClose } from './window-view-can-close';\r\n\r\n@Injectable()\r\nexport class WindowViewService {\r\n\r\n  private stack: ComponentRef<any>[] = [];\r\n\r\n  private outlet: ViewContainerRef;\r\n\r\n  private _length$: Subject<number> = new Subject<number>();\r\n\r\n  private _onOpen$: Subject<ComponentRef<any>> = new Subject<ComponentRef<any>>();\r\n\r\n  private _onClose$: Subject<ComponentRef<any>> = new Subject<ComponentRef<any>>();\r\n\r\n  get length$(): Observable<number> { return this._length$.asObservable(); }\r\n\r\n  get onOpen$(): Observable<ComponentRef<any>> { return this._onOpen$.asObservable(); }\r\n\r\n  get onClose$(): Observable<ComponentRef<any>> { return this._onClose$.asObservable(); }\r\n\r\n  constructor(private dcl: DynamicComponentLoader) {}\r\n\r\n  setOutlet(outlet: ViewContainerRef) {\r\n    this.outlet = outlet;\r\n  }\r\n\r\n  pushWindow(Component: Type, providers: ResolvedReflectiveProvider[] = []): Promise<ComponentRef<any>> {\r\n    return this.dcl.loadNextToLocation(Component, this.outlet, providers)\r\n      .then((componentRef: ComponentRef<any>) => {\r\n        this.stack.push(componentRef);\r\n        this._onOpen$.next(componentRef);\r\n        this._length$.next(this.stack.length);\r\n        return componentRef;\r\n      });\r\n  }\r\n\r\n  popWindow(): boolean {\r\n    let componentRef: ComponentRef<any> = this.stack.pop();\r\n    if (!this.canCloseWindowView(componentRef)) {\r\n      this.stack.push(componentRef);\r\n      return false;\r\n    }\r\n    this._onClose$.next(componentRef);\r\n    this._length$.next(this.stack.length);\r\n    componentRef.destroy();\r\n    return true;\r\n  }\r\n\r\n  canCloseWindowView(componentRef: ComponentRef<WindowViewCanClose>) {\r\n    if (!componentRef.instance.windowViewCanClose) {\r\n      return true;\r\n    }\r\n    return componentRef.instance.windowViewCanClose();\r\n  }\r\n\r\n}\r\n"]}