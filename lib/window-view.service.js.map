{"version":3,"file":"window-view.service.js","sourceRoot":"","sources":["../Users/yujuiting/projects/github-projects/ng2-window-view/src/lib/window-view.service.ts"],"names":[],"mappings":";;;;;;;;;;AAAA,qBAE2C,eAAe,CAAC,CAAA;AAC3D,wBAAwB,cAAc,CAAC,CAAA;AAKvC;IAkBE,2BAAoB,GAA2B;QAA3B,QAAG,GAAH,GAAG,CAAwB;QAhBvC,UAAK,GAAwB,EAAE,CAAC;QAIhC,aAAQ,GAAoB,IAAI,iBAAO,EAAU,CAAC;QAElD,aAAQ,GAA+B,IAAI,iBAAO,EAAqB,CAAC;QAExE,cAAS,GAA+B,IAAI,iBAAO,EAAqB,CAAC;IAQ/B,CAAC;IANnD,sBAAI,sCAAO;aAAX,cAAoC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAE1E,sBAAI,sCAAO;aAAX,cAA+C,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAErF,sBAAI,uCAAQ;aAAZ,cAAgD,MAAM,CAAC,IAAI,CAAC,SAAS,CAAC,YAAY,EAAE,CAAC,CAAC,CAAC;;;OAAA;IAIvF,qCAAS,GAAT,UAAU,MAAwB;QAChC,IAAI,CAAC,MAAM,GAAG,MAAM,CAAC;IACvB,CAAC;IAED,sCAAU,GAAV,UAAW,SAAe,EAAE,SAA4C;QAAxE,iBAQC;QAR2B,yBAA4C,GAA5C,cAA4C;QACtE,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,kBAAkB,CAAC,SAAS,EAAE,IAAI,CAAC,MAAM,EAAE,SAAS,CAAC;aAClE,IAAI,CAAC,UAAC,YAA+B;YACpC,KAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC9B,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YACjC,KAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,KAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;YACtC,MAAM,CAAC,YAAY,CAAC;QACtB,CAAC,CAAC,CAAC;IACP,CAAC;IAED,qCAAS,GAAT;QACE,EAAE,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,KAAK,CAAC,CAAC,CAAC,CAAC;YAC5B,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QACD,IAAI,YAAY,GAAsB,IAAI,CAAC,KAAK,CAAC,GAAG,EAAE,CAAC;QACvD,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,CAAC,CAAC,CAAC;YAC3C,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAC9B,MAAM,CAAC,KAAK,CAAC;QACf,CAAC;QACD,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;QAClC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,IAAI,CAAC,KAAK,CAAC,MAAM,CAAC,CAAC;QACtC,YAAY,CAAC,OAAO,EAAE,CAAC;QACvB,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;IAED,8CAAkB,GAAlB,UAAmB,YAA8C;QAC/D,EAAE,CAAC,CAAC,OAAO,YAAY,CAAC,QAAQ,CAAC,kBAAkB,IAAI,UAAU,CAAC,CAAC,CAAC;YAClE,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QACD,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,kBAAkB,EAAE,CAAC;IACpD,CAAC;IAvDH;QAAC,iBAAU,EAAE;;yBAAA;IAyDb,wBAAC;AAAD,CAAC,AAxDD,IAwDC;AAxDY,yBAAiB,oBAwD7B,CAAA","sourcesContent":["import { Injectable, Type, Injector,\n         DynamicComponentLoader, ViewContainerRef, ComponentRef,\n         ResolvedReflectiveProvider } from '@angular/core';\nimport { Subject } from 'rxjs/Subject';\nimport { Observable } from 'rxjs/Observable';\nimport { WindowViewCanClose } from './window-view-can-close';\n\n@Injectable()\nexport class WindowViewService {\n\n  private stack: ComponentRef<any>[] = [];\n\n  private outlet: ViewContainerRef;\n\n  private _length$: Subject<number> = new Subject<number>();\n\n  private _onOpen$: Subject<ComponentRef<any>> = new Subject<ComponentRef<any>>();\n\n  private _onClose$: Subject<ComponentRef<any>> = new Subject<ComponentRef<any>>();\n\n  get length$(): Observable<number> { return this._length$.asObservable(); }\n\n  get onOpen$(): Observable<ComponentRef<any>> { return this._onOpen$.asObservable(); }\n\n  get onClose$(): Observable<ComponentRef<any>> { return this._onClose$.asObservable(); }\n\n  constructor(private dcl: DynamicComponentLoader) {}\n\n  setOutlet(outlet: ViewContainerRef) {\n    this.outlet = outlet;\n  }\n\n  pushWindow(Component: Type, providers: ResolvedReflectiveProvider[] = []): Promise<ComponentRef<any>> {\n    return this.dcl.loadNextToLocation(Component, this.outlet, providers)\n      .then((componentRef: ComponentRef<any>) => {\n        this.stack.push(componentRef);\n        this._onOpen$.next(componentRef);\n        this._length$.next(this.stack.length);\n        return componentRef;\n      });\n  }\n\n  popWindow(): boolean {\n    if (this.stack.length === 0) {\n      return false;\n    }\n    let componentRef: ComponentRef<any> = this.stack.pop();\n    if (!this.canCloseWindowView(componentRef)) {\n      this.stack.push(componentRef);\n      return false;\n    }\n    this._onClose$.next(componentRef);\n    this._length$.next(this.stack.length);\n    componentRef.destroy();\n    return true;\n  }\n\n  canCloseWindowView(componentRef: ComponentRef<WindowViewCanClose>) {\n    if (typeof componentRef.instance.windowViewCanClose != 'function') {\n      return true;\n    }\n    return componentRef.instance.windowViewCanClose();\n  }\n\n}\n"]}